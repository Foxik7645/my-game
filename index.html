<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Map Game ‚Äî UI Test Build</title>

  <!-- Fonts & Leaflet -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    :root{
      --cream:#F5E6C8; --accent:#ffd56a;
      --xp-filled-top:#d07be0; --xp-filled-bottom:#763d84;
      --xp-empty-top:#5d2f68;  --xp-empty-bottom:#412249;
    }
    html,body{height:100%;margin:0;background:#1e1e1e;color:#eee;font-family:'Segoe UI',sans-serif;}
    .pixel{font-family:'Press Start 2P','VT323',monospace; image-rendering:pixelated;}

    /* –ö–∞—Ä—Ç–∞ */
    #map{position:relative; height:100vh; width:100vw; overflow:hidden;}

    /* –¢–æ—Å—Ç—ã */
    #toasts{position:fixed; right:12px; bottom:12px; display:flex; flex-direction:column; gap:8px; z-index:3500;}
    .toast{background:#2d2b2d; border:1px solid #444; border-radius:10px; padding:10px 12px; box-shadow:0 8px 24px rgba(0,0,0,.35); min-width:280px;}

    /* ====== –ù–æ–≤—ã–π –Ω–∏–∂–Ω–∏–π HUD ====== */
    #bottomHud{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      display:flex; align-items:center; gap:16px; z-index:3000;
      pointer-events:none; /* –∫–∞—Ä—Ç–∞ –∫–ª–∏–∫–∞–µ—Ç—Å—è, —É –∫–Ω–æ–ø–æ–∫ –≤–∫–ª—é—á–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ */
    }

    /* –ª–µ–≤–∞—è –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
    .hud-left .botton-hud{
      width:460px; height:88px;
      background:url('./images/FinalUi/Botton_Hud.png') left center/contain no-repeat;
      image-rendering:pixelated;
    }

    /* —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π HUD-–±–∞—Ä ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π */
    .hud-center{
      position:relative; width:960px; height:128px;
      background:url('./images/FinalUi/HUD.png') center/contain no-repeat;
      image-rendering:pixelated;
    }
    /* ¬´–∫–æ—Ä—ã—Ç–æ¬ª –¥–ª—è XP ‚Äî –ø–æ–¥–≥–æ–Ω–∏ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ left/right/top/height */
    .hud-center .xp-track{
      position:absolute; left:140px; right:140px; top:34px; height:32px;
      overflow:hidden; pointer-events:none; border-radius:2px;
      background:linear-gradient(to bottom,var(--xp-empty-top),var(--xp-empty-bottom));
    }
    .hud-center .xp-fill{
      height:100%; width:0%;
      background:linear-gradient(to bottom,var(--xp-filled-top),var(--xp-filled-bottom));
      transition:width .25s ease;
    }
    /* –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–æ–ª—å—à–æ–π –∫—Ä–∏—Å—Ç–∞–ª–ª –ø–æ–≤–µ—Ä—Ö HUD (–µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª images/FinalUi/Crystal.png) */
    .hud-center .hud-crystal{
      position:absolute; left:50%; top:16px; transform:translateX(-50%);
      width:46px; height:78px; /* –ø–æ–¥–≥–æ–Ω–∏ –ø–æ–¥ —Å–≤–æ–π —Å–ø—Ä–∞–π—Ç */
      background:url('./images/FinalUi/Crystal.png') center/contain no-repeat;
      image-rendering:pixelated; pointer-events:none;
    }

    /* –ø—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å ‚Äî –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
    .hud-right{ display:flex; align-items:center; gap:14px; }
    .hud-btn{
      width:180px; height:72px; /* –µ–¥–∏–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –≤—Å–µ—Ö */
      border:none; background:transparent;
      background-size:contain; background-repeat:no-repeat; background-position:center;
      display:flex; align-items:center; justify-content:center; gap:8px;
      padding:0 18px; cursor:pointer; filter:drop-shadow(0 2px 0 rgba(0,0,0,.6));
      pointer-events:auto; image-rendering:pixelated;
    }
    .hud-btn:active{ transform:translateY(1px); }

    #moneyBtn{ background-image:url('./images/FinalUi/Icon_Dollar.png'); }
    #moneyText{
      color:#ffd56a; font-size:18px; line-height:1; user-select:none;
      text-shadow:0 1px 0 #000, 0 1px 6px rgba(0,0,0,.35);
    }
    #upgradeBtn{ background-image:url('./images/FinalUi/Icon_Arrow.png'); }
    #settingsBtn{ background-image:url('./images/FinalUi/Setting.png'); }

    /* –ú–∞–≥–∞–∑–∏–Ω (–¥–µ–º–æ –¥–ª—è –∫–ª–∏–∫–∞) */
    #shopPanel{
      position:fixed; top:88px; left:0; bottom:0; width:330px; background:#222;
      border-right:1px solid #3a3a3a; z-index:3150; display:none; overflow-y:auto; padding:12px; box-shadow:8px 0 20px rgba(0,0,0,.35);
    }
    #shopHeader{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;}
    #shopClose{cursor:pointer; background:#444; color:#eee; border:none; padding:6px 10px; border-radius:8px;}
    .card{position:relative; width:300px; height:438px; margin:10px auto; image-rendering:pixelated; border-radius:12px; box-shadow:0 10px 18px rgba(0,0,0,.35); cursor:pointer; overflow:hidden; background:#2b2b2b;}
    .card .title{position:absolute; top:18px; left:16px; right:16px; font-size:13px; color:var(--cream);}
    .card .desc{position:absolute; left:16px; right:16px; bottom:22px; font-size:12px; line-height:1.25; color:var(--cream);}
    .buybar{position:absolute; top:0; left:0; right:0; height:60px; z-index:3; background:linear-gradient(#2b2b2b,#1e1e1e); border-bottom:1px solid #555; display:flex; align-items:center; justify-content:center; gap:10px;}
    .price{color:var(--accent); font-size:12px;}

    /* –∞–¥–∞–ø—Ç–∏–≤ */
    @media (max-width: 1480px){
      #bottomHud{ transform:translateX(-50%) scale(.95); transform-origin:bottom center; }
    }
    @media (max-width: 1280px){
      #bottomHud{ transform:translateX(-50%) scale(.85); }
    }
  </style>
</head>
<body>

  <!-- –ö–∞—Ä—Ç–∞ -->
  <div id="map"></div>

  <!-- –ù–æ–≤—ã–π –Ω–∏–∂–Ω–∏–π HUD -->
  <div id="bottomHud" class="pixel">
    <div class="hud-left">
      <div class="botton-hud" aria-hidden="true"></div>
    </div>

    <div class="hud-center">
      <div class="xp-track"><div id="xpFill" class="xp-fill"></div></div>
      <!-- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–æ–ª—å—à–æ–π –∫—Ä–∏—Å—Ç–∞–ª–ª (–µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª) -->
      <div class="hud-crystal" aria-hidden="true"></div>
    </div>

    <div class="hud-right">
      <button id="moneyBtn" class="hud-btn" type="button" title="–ë–∞–ª–∞–Ω—Å">
        <span id="moneyText">$0</span>
      </button>
      <button id="upgradeBtn" class="hud-btn" type="button" title="–ú–∞–≥–∞–∑–∏–Ω/–ü–æ—Å—Ç—Ä–æ–π–∫–∞"></button>
      <button id="settingsBtn" class="hud-btn" type="button" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"></button>
    </div>
  </div>

  <!-- –ú–∞–≥–∞–∑–∏–Ω (–¥–µ–º–æ) -->
  <aside id="shopPanel" class="pixel">
    <div id="shopHeader">
      <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
      <button id="shopClose">√ó</button>
    </div>
    <div class="card">
      <div class="buybar">
        <span class="price">100 üí∞</span>
        <button class="pixel" style="background:#444;color:#fff;border:none;border-radius:8px;padding:6px 10px;">–ö—É–ø–∏—Ç—å</button>
      </div>
      <div class="title">–î–æ–º –¥—Ä–æ–≤–æ—Å–µ–∫–∞</div>
      <div class="desc">–†–∞–±–æ—á–∏–µ –¥–æ–±—ã–≤–∞—é—Ç –¥–µ—Ä–µ–≤–æ —Ä—è–¥–æ–º –∏ –Ω–æ—Å—è—Ç –≤ –¥–æ–º.</div>
    </div>
    <div class="card">
      <div class="buybar">
        <span class="price">100 üí∞</span>
        <button class="pixel" style="background:#444;color:#fff;border:none;border-radius:8px;padding:6px 10px;">–ö—É–ø–∏—Ç—å</button>
      </div>
      <div class="title">–î–æ–º —à–∞—Ö—Ç—ë—Ä–∞</div>
      <div class="desc">–ü–æ–±–ª–∏–∑–æ—Å—Ç–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∫–∞–º–Ω–∏.</div>
    </div>
  </aside>

  <!-- –¢–æ—Å—Ç—ã -->
  <div id="toasts"></div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- –ò–≥—Ä–∞: –æ—Ñ–ª–∞–π–Ω —Ç–µ—Å—Ç –±–µ–∑ Firebase/Auth -->
  <script type="module">
    /* ===== –ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï (–æ—Ñ–ª–∞–π–Ω –¥–ª—è —Ç–µ—Å—Ç–æ–≤ UI) ===== */
    const resources = { money: 30434, wood: 10, stone: 0, corn: 0, food: 30 };
    let level = 3, xp = 250;     // –Ω–µ –ø—É—Å—Ç—ã–µ, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ –ø—Ä–æ–≥—Ä–µ—Å—Å
    const BASE_XP = 500;
    const $ = (id)=>document.getElementById(id);

    /* –¢–æ—Å—Ç—ã */
    function showToast(text, actions=[], ms=1800){
      const host = $('toasts'); if(!host) return;
      const t = document.createElement('div'); t.className='toast pixel'; t.textContent=text;
      host.appendChild(t);
      setTimeout(()=>{ t.remove(); }, ms);
    }

    /* ===== –ö–∞—Ä—Ç–∞ ===== */
    await new Promise(r => (document.readyState!=='loading')?r():window.addEventListener('DOMContentLoaded', r, {once:true}));
    const map = L.map('map', { zoomControl:false }).setView([55.751244, 37.618423], 13);
    L.tileLayer('https://cartodb-basemaps-a.global.ssl.fastly.net/dark_nolabels/{z}/{x}/{y}{r}.png',
      { attribution: '¬©OpenStreetMap ¬©Carto', subdomains: 'abcd', maxZoom: 19 }).addTo(map);

    /* ===== XP ===== */
    function getRequiredXp(lvl){ return BASE_XP * lvl; }
    function updateXpHUD(){
      const required = getRequiredXp(level);
      const p = Math.max(0, Math.min(1, xp / required));
      const fill = $('xpFill'); if(fill) fill.style.width = (p*100).toFixed(2)+'%';
    }
    function addXP(amount){
      xp += amount;
      let required = getRequiredXp(level);
      while (xp >= required){
        xp -= required; level++; required = getRequiredXp(level);
        showToast(`üìà –£—Ä–æ–≤–µ–Ω—å ${level}!`,[],1500);
      }
      updateXpHUD();
    }

    /* ===== –î–µ–Ω—å–≥–∏ ===== */
    function updateMoneyHUD(){
      const el = $('moneyText');
      if(el) el.textContent = '$' + (resources.money ?? 0).toLocaleString('ru-RU');
    }

    /* –ü–µ—Ä–≤–∏—á–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ HUD */
    updateMoneyHUD(); updateXpHUD();

    /* ===== –ö–Ω–æ–ø–∫–∏ HUD ===== */
    const upgradeBtn = $('upgradeBtn');
    const settingsBtn = $('settingsBtn');
    const shopPanel = $('shopPanel');
    const shopClose = $('shopClose');

    if (upgradeBtn){
      upgradeBtn.addEventListener('click', ()=>{
        shopPanel.style.display = (shopPanel.style.display==='block') ? 'none' : 'block';
      });
    }
    if (shopClose){
      shopClose.addEventListener('click', ()=>{ shopPanel.style.display='none'; });
    }
    if (settingsBtn){
      settingsBtn.addEventListener('click', ()=>{
        showToast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üîß');
      });
    }

    /* ===== –î–µ–º–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞: –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫ +20 XP –∏ +5 –¥–µ–Ω–µ–≥ ===== */
    setInterval(()=>{
      resources.money += 5; updateMoneyHUD();
      addXP(20);
    }, 2000);
  </script>
</body>
</html>
